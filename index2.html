<！doctype html>
<超文本标记语言 朗="zh-CN">
<头>
    <元 字符集="UTF-8">
    <元 姓名="视口" 内容="宽度=设备宽度，初始比例=1.0">
    <标题>温馨祝福v3.1</标题>
    <风格>
        /* --- 基础样式 --- */
        身体,超文本标记语言 {
            边缘:0;填充:0;宽度:100%;高度:100%;
            溢出:隐藏的;
            字体系列:-apple-系统,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,无衬线;
            过渡:背景色 0.5s;
        }

        /* --- 主题配色 --- */
        身体 { 背景色：#f4f4f9；}
        身体.暖主题 { 背景色：#fff8e1；}
        身体.主题-酷 { 背景色：#e3f2fd；}
        身体.主题-深色 { 背景色: #333;}
        身体.主题-绿色 { 背景色：#e8f5e9；}

        /* --- 卡片通用样式 --- */
.浮动卡 {
            位置:绝对的;Z指数:1;
            动画:fadeInOut 4s 易进易出 向前;
            边界半径:8PX;
            箱形阴影:0 4PX 12PX RGBA(0,0,0,0.08);
            边境:3PX 固体#ddd；
        }

        /* --- 卡片样式 --- */
.信息卡 {
            填充:12PX 20PX;
            背景:RGBA(255,255,255,0.95);
            空白:noWrap;
        }

        /* --- 图片卡片样式 --- */
.图像卡片 {
            填充:0;
            背景：#fff；
            最大宽度:250PX;
            最大高度:250PX;
            溢出:隐藏的;
        }
.图像卡片 IMG {
            显示:块;宽度:100%;高度:100%;
            最大宽度:250PX;最大高度:250PX;
            对象拟合:覆盖;
            边界半径:6PX;
        }

        /* --- 主题卡片颜色 (同步边框) --- */
        身体.信息卡 { 边框颜色：#ddd；}
        身体.图像卡片 { 边框颜色：#ccc；}
        身体.暖主题.信息卡 { 背景：#fffbeb；边框颜色：#ffe57f；颜色：#6d4c00；}
        身体.暖主题.图像卡片 { 边框颜色：#ffe57f；}
        身体.主题-酷.信息卡 { 背景：#eef8ff；边框颜色：#90caf9；颜色：#0d47a1；}
        身体.主题-酷.图像卡片 { 边框颜色：#90caf9；}
        身体.主题-深色.信息卡 { 背景: #424242;边框颜色: #616161;颜色：#eee；}
        身体.主题-深色.图像卡片 { 边框颜色: #616161;}
        身体.主题-绿色.信息卡 { 背景：#f1f8e9；边框颜色：#a5d6a7；颜色：#1b5e20；}
        身体.主题-绿色.图像卡片 { 边框颜色：#a5d6a7；}

        /* 卡片动画 */
        @keyframes fadeInOut {
0%{不透明度：0；改变：规模(0.8)translateY(20px)；}
25%{不透明度：1；改变：规模(1)translateY(0)；}
75%{不透明度：1；改变：规模(1)translateY(0)；}
100%{不透明度：0；改变：规模(0.9)translateY(-10px)；}
}

/* --- 控制栏 (悬停) --- */
.控制 {
位置：固定；顶部：0；右侧：0；填充：20px；
Z索引：1000；显示：柔度；间隙：10px；
不透明度：0；
过渡：不透明度0.3s易进易出；
}
.控件：悬停，
.controls.force-visible{opacity:1；}
.控制按钮{
填充：10px18px；字体大小：16px；
背景色：#fff；颜色：#333；
边框：1px实体#ccc；边框半径：8px；
cursor：指针；box-shadow:02px5px rgba(0，0，0，0.1)；
}

/* --- 菜单 --- */
.menu-panel{
位置：固定；顶部：70px；右侧：20px；宽度：300px；
背景：#fff；边框：1px实心#ccc；
边界半径：8px；盒阴影：06px20px rgba(0，0，0，0.2)；
填充：020px20px20px；
Z索引：999；框大小：边框框；
显示：无；
最大高度：calc(100vh-100px)；
overflow-y：自动；
}
.menu-panel.visible{display:block；}
        
.menu-节{
页边距顶部：20px；页边距顶部：20px；
border-top:1px实体#eee；
}
.menu-节：第一个子项{
上边距：20px；上边距：0；上边框：无；
}
.menu-section h3{margin-top:0；margin-bottom:15px；}
.menu-区段。隐藏{display:none；}/*彩蛋*/

/* 菜单 - 主题选择 */
.theme-selector{
显示：网格；网格-模板-列：重复(3，1fr)；
间隙：8px；底边距：20px；
}
.主题按钮{
填充：8px12px；边框：1px实心#ddd；
边框半径：6px；光标：指针；
背景：#f9f9f9；字体大小：14px；文本对齐：居中；
}
/* 主题按钮点击后的高亮 */
.theme-button.clicked{
背景：#cce7ff；
边框颜色：#007bff；
}

/* 菜单 - 设置项 */
.设置-项目{
显示：柔度；对齐内容：间距；
对齐项：居中；下边距：12px；
}
.设置项标签{font-size:14px；color：#333；}
.设置项输入[type="number"]，
.设置-项目选择{
宽度：90px；填充：5px8px；边框：1px实心#ccc；
边框半径：4px；字体大小：14px；框大小：边框框；
}
.setting-note{
font-size:12px；color：#666；
上边距：-10px；下边距：15px；
.

/* 菜单 - 话语编辑 */
#短语输入{
宽度：100%；高度：150px；框大小：边框框；
边框：1px实体#ccc；边框半径：6px；
填充：10px；字体大小：14px；行高：1.5；
调整大小：垂直；
}

/* 菜单 - 按钮 */
#save-button{
宽度：100%；填充：12px；字体大小：16px；
背景色：#007bff；颜色：白色；
边框：无；边框半径：6px；
光标：指针；上边距：15px；
.
paddingstyle>
</头>
<身体>

overflowdiv：隐藏；"controls">
}button id="pause-button"class="control-button">暂停</按钮>
.图像卡按钮img={class="control-button">菜单</按钮>
displaydiv>

object-fitdiv：封面；"menu-panel"class="menu-panel">
        
}div class="menu-section">
            <H3>🎨  切换主题</H3>
/*---主题卡片颜色(同步边框)---*/div class="主题选择器">
bodybutton.message-card={border-color：#ddd；}>默认</按钮>
bodybutton.image-card={border-color：#ccc；}>温暖</按钮>
bodybutton.theme-warm.message-card{=background>：#fffbeb；border-colorbutton>
bodybutton.theme-warm.image-card{=border-color>：#ffe57f；}button>
bodybutton.theme-cool.Message-card{=background>：#eef8ff；border-colorbutton>
bodydiv>
bodydiv>

bodydiv.theme-green.message-card>
<H3>            <H3>⚙️  效果设置</H3></H3>
            <div 班级="设置项目">
                <标签 为="速度输入">生成速度 (毫秒)</标签>
                <输入 类型="数字" 身份标识="速度输入" 最小值="100" 步="100">
            </div>
            <p 班级="设置注释">(建议 100-2000 之间，越小越快)</p>
            <div class="setting-item">
                <label for="duration-input">消失时间 (毫秒)</label>
                <input type="number" id="duration-input" min="1000" step="500">
            </div>
            <p class="setting-note">(建议 2000-8000 之间，越长停留越久)</p>
        </div>

        <div class="menu-section">
            <h3>✏️ 编辑温馨话语</h3>
            <p style="font-size: 12px; color: #666; margin-top: 0;">(每行一句)</p>
            <textarea id="phrases-input"></textarea>
        </div>

        <div id="image-settings" class="menu-section hidden">
            <h3>🖼️ 图片设置 <span style="font-size: 12px; color: #007bff;">(已解锁)</span></h3>
            
            <input type="file" id="image-upload" multiple accept="image/*" style="width: 100%; margin-bottom: 10px;">
            <p id="image-status" style="font-size: 14px; color: #333; margin: 5px 0 10px;">已加载 0 / 50 张图片</p>
            <p class="setting-note" style="margin-top: 0; color: #d9534f;">(注意：图片仅在当前会话有效，关闭页面将丢失)</p>

            <div class="setting-item">
                <label for="border-size-input">边框大小 (px)</label>
                <input type="number" id="border-size-input" min="0" max="20" step="1" value="3">
            </div>
             <div class="setting-item">
                <label for="border-style-input">边框样式</label>
                <select id="border-style-input">
                    <option value="solid">实线</option>
                    <option value="dashed">虚线</option>
                    <option value="double">双实线</option>
                    <option value="dotted">点线</option>
                </select>
            </div>
        </div>
        
        <button id="save-button">保存并关闭</button>
    </div>

    <script>
        // --- 状态变量 ---
        let isPaused = false;
        let messageInterval;
        let messages = [
            "你好呀！", "今天也要开心哦！", "你是最棒的！",
            "加油！", "一切都会好起来的", "世界因为你而美好",
            "别忘了休息", "保持微笑 :)"
        ];
        let messageSpawnRate = 700;
        let messageDuration = 3900;
        
        // --- 图片功能变量 ---
        let userImages = [];
        const MAX_IMAGES = 50;
        let imageFeatureUnlocked = false;
        const unlockedThemes = new Set();
        let imageBorderSize = 3;
        let imageBorderStyle = 'solid';
        let imageSpawnChance = 0.3;

        // --- DOM 元素 (已修改) ---
        const controlsContainer = document.querySelector('.controls');
        const pauseButton = document.getElementById('pause-button');
        const menuButton = document.getElementById('menu-button');
        const menuPanel = document.getElementById('menu-panel');
        const phrasesInput = document.getElementById('phrases-input');
        const saveButton = document.getElementById('save-button');
        const themeSelector = document.querySelector('.theme-selector');
        const speedInput = document.getElementById('speed-input');
        const durationInput = document.getElementById('duration-input');
        
        // --- 图片功能 DOM 元素 ---
        const imageSettingsSection = document.getElementById('image-settings');
        const imageUpload = document.getElementById('image-upload');
        const imageStatus = document.getElementById('image-status');
        const borderSizeInput = document.getElementById('border-size-input');
        const borderStyleInput = document.getElementById('border-style-input');
        
        // --- 🔴 已移除 imageSettingsLock 变量 ---

        /**
         * 生成元素的总控函数
         */
        function spawnElement() {
            if (isPaused) { return; }
            const shouldSpawnImage = userImages.length > 0 && Math.random() < imageSpawnChance;
            if (shouldSpawnImage) {
                createImageCard();
            } else {
                createMessageCard();
            }
        }

        /**
         * 创建一个话语卡片
         */
        function createMessageCard() {
            const card = document.createElement('div');
            card.className = 'floating-card message-card';
            const text = messages[Math.floor(Math.random() * messages.length)];
            card.textContent = text;
            setupCardPositionAndAnimation(card);
        }
        
        /**
         * 创建一个图片卡片
         */
        function createImageCard() {
            const card = document.createElement('div');
            card.className = 'floating-card image-card';
            const img = document.createElement('img');
            img.src = userImages[Math.floor(Math.random() * userImages.length)];
            card.appendChild(img);
            card.style.borderWidth = `${imageBorderSize}px`;
            card.style.borderStyle = imageBorderStyle;
            setupCardPositionAndAnimation(card);
        }
        
        /**
         * 设置卡片位置和动画 (通用逻辑)
         */
        function setupCardPositionAndAnimation(cardElement) {
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;
            const x = Math.random() * (viewportWidth - 250) + 20; 
            const y = Math.random() * (viewportHeight - 100) + 20;
            cardElement.style.left = `${x}px`;
            cardElement.style.top = `${y}px`;
            cardElement.style.animationDuration = `${messageDuration / 1000}s`;
            document.body.appendChild(cardElement);
            setTimeout(() => {
                cardElement.remove();
            }, messageDuration);
        }

        /**
         * 启动/停止话语生成
         */
        function startSpawning() {
            stopSpawning(); 
            if (!messageInterval) {
                messageInterval = setInterval(spawnElement, messageSpawnRate);
            }
        }
        function stopSpawning() {
            clearInterval(messageInterval);
            messageInterval = null;
        }

        /**
         * 暂停/开启 按钮事件
         */
        pauseButton.addEventListener('click', () => {
            isPaused = !isPaused;
            if (isPaused) {
                pauseButton.textContent = '开启';
                stopSpawning();
            } else {
                pauseButton.textContent = '暂停';
                startSpawning();
            }
        });

        /**
         * 菜单 按钮事件
         */
        menuButton.addEventListener('click', () => {
            const isVisible = menuPanel.classList.toggle('visible');
            controlsContainer.classList.toggle('force-visible', isVisible);
            if (isVisible) {
                phrasesInput.value = messages.join('\n');
                speedInput.value = messageSpawnRate;
                durationInput.value = messageDuration;
                if (imageFeatureUnlocked) {
                    borderSizeInput.value = imageBorderSize;
                    borderStyleInput.value = imageBorderStyle;
                }
            }
        });

        /**
         * 保存 按钮事件
         */
        saveButton.addEventListener('click', () => {
            const newText = phrasesInput.value;
            const newMessages = newText.split('\n')
                                     .map(line => line.trim()) 
                                     .filter(line => line.length > 0); 
            if (newMessages.length > 0) { messages = newMessages; }
            const newSpeed = parseInt(speedInput.value, 10);
            const newDuration = parseInt(durationInput.value, 10);
            if (newSpeed && newSpeed >= 100) { messageSpawnRate = newSpeed; }
            if (newDuration && newDuration >= 1000) { messageDuration = newDuration; }
            if (imageFeatureUnlocked) {
                imageBorderSize = parseInt(borderSizeInput.value, 10) || 3;
                imageBorderStyle = borderStyleInput.value || 'solid';
            }
            stopSpawning();
            if (!isPaused) { startSpawning(); }
            menuPanel.classList.remove('visible');
            controlsContainer.classList.remove('force-visible');
            alert('设置已保存！');
        });

        /**
         * 解锁图片功能 (已修改)
         */
        function unlockImageFeature() {
            if (imageFeatureUnlocked) return;
            imageFeatureUnlocked = true;
            imageSettingsSection.classList.remove('hidden'); // 只需显示功能区
            
            // 🔴 已移除对 imageSettingsLock 的引用

            borderSizeInput.value = imageBorderSize;
            borderStyleInput.value = imageBorderStyle;
            alert('🎉 隐藏功能解锁！您现在可以添加图片了！');
        }

        /**
         * 处理图片上传
         */
        function handleImageUpload(event) {
            const files = event.target.files;
            if (!files) return;
            for (let i = 0; i < files.length; i++) {
                if (userImages.length >= MAX_IMAGES) {
                    alert(`最多只能添加 ${MAX_IMAGES} 张图片。`);
                    break;
                }
                const file = files[i];
                if (!file.type.startsWith('image/')){ continue; }
                const reader = new FileReader();
                reader.onload = (e) => {
                    if (userImages.length < MAX_IMAGES) {
                        userImages.push(e.target.result);
                    }
                    updateImageStatus();
                }
                reader.readAsDataURL(file);
            }
            event.target.value = null; 
        }

        function updateImageStatus() {
            imageStatus.textContent = `已加载 ${userImages.length} / ${MAX_IMAGES} 张图片`;
        }

        // --- 事件监听 ---

        /**
         * 主题切换 事件 (彩蛋逻辑)
         */
        themeSelector.addEventListener('click', (event) => {
            const target = event.target;
            if (target.classList.contains('theme-button')) {
                const theme = target.dataset.theme;
                
                // 1. 应用主题
                document.body.className = document.body.className.replace(/\btheme-[^\s]*/g, '');
                if (theme !== 'default') {
                    document.body.classList.add(`theme-${theme}`);
                }
                
                // 2. 彩蛋逻辑
                if (!imageFeatureUnlocked) {
                    target.classList.add('clicked');
                    unlockedThemes.add(theme);
                    if (unlockedThemes.size === 5) { // 5个主题
                        unlockImageFeature();
                    }
                }
            }
        });
        
        // 监听图片上传
        imageUpload.addEventListener('change', handleImageUpload);

        /**
         * 启动
         */
        document.addEventListener('DOMContentLoaded', () => {
            startSpawning();
        });
    </script>
</body>
</html>

